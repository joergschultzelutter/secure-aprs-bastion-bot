# `secure-aprs-bastion-bot.py`

## Introduction

`secure-aprs-bastion-bot.py` uses my [`core-aprs-client`](https://github.com/joergschultzelutter/core-aprs-client) framework and stores its APRS-bot-specific content in the configuration file `secure-aprs-bastion-bot.cfg`.

- You can find a [preconfigured template file](/src/secure-aprs-bastion-bot/secure-aprs-bastion-bot.cfg.TEMPLATE) in `secure-aprs-bastion-bot`'s source folder.
- All generic parts of the configuration file, such as the configuration of beacons and bulletins, are described in detail in the accompanying [configuration file documentation](https://github.com/joergschultzelutter/core-aprs-client/blob/master/docs/configuration.md).
- Only the parameters specific to the `secure-aprs-bastion-bot` (custom configuration) are described in the following document section. Normally, you are not required to apply any changes to this configuration section.
- Mandatory tasks for installing your very own `secure-aprs-bastion-bot` instance:
  - rename the existing template `secure-aprs-bastion-bot.cfg.TEMPLATE` to `secure-aprs-bastion-bot.cfg`
  - amend the template file's [mandatory configuration sections](https://github.com/joergschultzelutter/core-aprs-client/blob/master/docs/configuration.md#mandatory-configuration-file-sections).

The configuration template file establishes a link between the bot's configuration file `secure-aprs-bastion-bot.cfg` and the additional configuration file `sabb-command-config.yml` (created via [configure](/docs/configure.md)) which holds information on the configured users (aka callsigns) along with their TOTP secrets, `command-code`s, and `command-string`s. Among additional parameters, the name of the user/command config file is stored in a dedicated section (`[secure_aprs_bastion_bot]`) of the `secure-aprs-bastion-bot.cfg` configuration file.

![Overview](/img/sabb_config_files.svg)

Changes to the user/command configuration file specified at the `sabb_command_config_file` config file section are detected by `secure-aprs-bastion-bot.py` and result in the configuration parameters being re-read; it is therefore _not_ necessary to restart `secure-aprs-bastion-bot.py` when the `sabb_command_config.` configuration file is changed.

| Config variable                | Type  | Default value              | Description                                                                                                                                                                             |
|--------------------------------|-------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `sabb_command_config_file`     | `str` | `sabb_command_config.yaml` | Name of the external configuration file (generated by [`configure.py`](configure.md)) which contains the approved users/callsigns and `--command-code`/`--command-script` configuration |
| `sabb_totp_cache_max_entries`  | `int` | `250`                      | Defines the maximum number of callsign/TOTP entries that are checked for ingress duplicates.                                                                                            |
| `sabb_totp_cache_time_to_live` | `int` | `300` (5 mins)             | Sets the life span for a dupe detection's dictionary entry (unit of measure = seconds).                                                                                                 |


> [!TIP]
> `secure-aprs-bastion-bot` automatically detects whether the `sabb_command_config_file` configuration file has changed and re-reads it if necessary. This means that it is not necessary to restart the bot when the configuration file `sabb_command_config_file` is changed.

The respective section from `core-aprs-client`'s config file for `[secure_aprs_bastion_bot]` lists as follows:

```
[secure_aprs_bastion_bot]
#
# This is the external configuration file which contains the user 
# configuration along with its command-code/command-script settings
sabb_command_config_file=sabb_command_config.yaml
#
# maximum number of TOTP/callsign combinations
sabb_totp_cache_max_entries = 250
#
# max time span of TOTP dupe detection in seconds (300 sec = 5 mins)
sabb_totp_cache_time_to_live = 300
```
